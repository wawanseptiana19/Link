<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Advanced HTML Runner - Versi Canggih</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/material-darker.min.css">
  <style>
    body {
      background-color: #f8f9fa;
      padding-top: 20px;
    }
    .CodeMirror {
      height: 300px;
    }
    .nav-tabs .nav-link {
      font-weight: bold;
    }
    #preview {
      border: 1px solid #ced4da;
      border-radius: 0.25rem;
      width: 100%;
      height: 400px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="mb-4 text-center">
      <h1>Advanced HTML Runner - Versi Canggih</h1>
      <p>Editor canggih dengan preview real-time, autosave, dan full screen preview.</p>
    </div>

    <!-- Editor Tab -->
    <ul class="nav nav-tabs" id="editorTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="html-tab" data-bs-toggle="tab" data-bs-target="#html" type="button" role="tab" aria-controls="html" aria-selected="true">HTML</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="css-tab" data-bs-toggle="tab" data-bs-target="#css" type="button" role="tab" aria-controls="css" aria-selected="false">CSS</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="js-tab" data-bs-toggle="tab" data-bs-target="#js" type="button" role="tab" aria-controls="js" aria-selected="false">JavaScript</button>
      </li>
    </ul>
    <div class="tab-content" id="editorTabContent">
      <div class="tab-pane fade show active" id="html" role="tabpanel" aria-labelledby="html-tab">
        <textarea id="htmlEditor"></textarea>
      </div>
      <div class="tab-pane fade" id="css" role="tabpanel" aria-labelledby="css-tab">
        <textarea id="cssEditor"></textarea>
      </div>
      <div class="tab-pane fade" id="js" role="tabpanel" aria-labelledby="js-tab">
        <textarea id="jsEditor"></textarea>
      </div>
    </div>

    <!-- Tombol Aksi -->
    <div class="mt-3 d-flex gap-2 flex-wrap">
      <button class="btn btn-primary flex-fill" onclick="runCode()">Jalankan Kode</button>
      <button class="btn btn-success flex-fill" onclick="downloadCode()">Download Kode</button>
      <button class="btn btn-info flex-fill" onclick="toggleFullScreen()">Full Screen Preview</button>
      <button class="btn btn-warning flex-fill" onclick="resetCode()">Reset Editor</button>
      <button class="btn btn-secondary flex-fill" onclick="clearAutosave()">Hapus Autosave</button>
    </div>

    <!-- Preview Panel -->
    <div class="mt-4">
      <h4>Preview</h4>
      <iframe id="preview" title="Preview Output"></iframe>
    </div>
  </div>

  <!-- Bootstrap JS & Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- CodeMirror JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
  <!-- Mode HTML -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
  <!-- Mode CSS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
  <!-- Mode JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
  
  <script>
    // Inisialisasi CodeMirror untuk setiap editor
    var htmlEditor = CodeMirror.fromTextArea(document.getElementById("htmlEditor"), {
      mode: "text/html",
      theme: "material-darker",
      lineNumbers: true,
      autoCloseTags: true
    });
    var cssEditor = CodeMirror.fromTextArea(document.getElementById("cssEditor"), {
      mode: "css",
      theme: "material-darker",
      lineNumbers: true,
      autoCloseBrackets: true
    });
    var jsEditor = CodeMirror.fromTextArea(document.getElementById("jsEditor"), {
      mode: "javascript",
      theme: "material-darker",
      lineNumbers: true,
      autoCloseBrackets: true
    });

    // Fungsi debounce untuk auto-run
    function debounce(func, delay) {
      let timer;
      return function() {
        clearTimeout(timer);
        timer = setTimeout(() => func.apply(this, arguments), delay);
      }
    }

    // Fungsi untuk menjalankan kode pada iframe preview
    function runCode() {
      var htmlContent = htmlEditor.getValue();
      var cssContent = "<style>" + cssEditor.getValue() + "</style>";
      var jsContent = "<script>" + jsEditor.getValue() + "<\/script>";
      var combinedCode = htmlContent + cssContent + jsContent;
      document.getElementById("preview").srcdoc = combinedCode;
      autosaveCode();
    }

    // Auto-run saat pengguna mengetik (debounced)
    var debouncedRun = debounce(runCode, 500);
    htmlEditor.on("change", debouncedRun);
    cssEditor.on("change", debouncedRun);
    jsEditor.on("change", debouncedRun);

    // Fungsi untuk mengunduh kode sebagai file HTML
    function downloadCode() {
      var htmlContent = htmlEditor.getValue();
      var cssContent = "<style>" + cssEditor.getValue() + "</style>";
      var jsContent = "<script>" + jsEditor.getValue() + "<\/script>";
      var combinedCode = htmlContent + "\n" + cssContent + "\n" + jsContent;
      var blob = new Blob([combinedCode], { type: 'text/html' });
      var a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'kode.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
    
    // Fungsi untuk toggle full screen preview menggunakan Fullscreen API
    function toggleFullScreen() {
      var previewElement = document.getElementById("preview");
      if (!document.fullscreenElement) {
        previewElement.requestFullscreen().catch(err => {
          alert("Error, tidak dapat masuk full screen: " + err.message);
        });
      } else {
        document.exitFullscreen();
      }
    }
    
    // Fungsi untuk mereset editor dan preview
    function resetCode() {
      if(confirm("Apakah Anda yakin ingin mereset editor? Kode yang ada akan dihapus.")) {
        htmlEditor.setValue("");
        cssEditor.setValue("");
        jsEditor.setValue("");
        document.getElementById("preview").srcdoc = "";
        autosaveCode(); // update localStorage
      }
    }
    
    // Fungsi autosave menggunakan localStorage
    function autosaveCode() {
      const codeData = {
        html: htmlEditor.getValue(),
        css: cssEditor.getValue(),
        js: jsEditor.getValue()
      };
      localStorage.setItem("advancedHtmlRunnerCode", JSON.stringify(codeData));
    }
    
    // Fungsi untuk memuat kode dari localStorage
    function loadAutosave() {
      const saved = localStorage.getItem("advancedHtmlRunnerCode");
      if (saved) {
        try {
          const codeData = JSON.parse(saved);
          htmlEditor.setValue(codeData.html || "");
          cssEditor.setValue(codeData.css || "");
          jsEditor.setValue(codeData.js || "");
          runCode();
        } catch(e) {
          console.error("Gagal memuat autosave:", e);
        }
      }
    }
    
    // Fungsi untuk menghapus data autosave
    function clearAutosave() {
      if(confirm("Hapus data autosave?")) {
        localStorage.removeItem("advancedHtmlRunnerCode");
        alert("Autosave telah dihapus.");
      }
    }
    
    // Muat data autosave saat halaman dimuat
    window.addEventListener("load", loadAutosave);
  </script>
</body>
</html>
